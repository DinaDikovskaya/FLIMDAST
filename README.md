# FLIMDAST
_**FLIM DA**ta**S**et **T**ool_ to analyse fluorescence lifetime changes in a time course FLIM experiment

## Description:
*FLIMDAST* is a user interface app that assembles pre-processed fluorescence lifetime imaging (FLIM) data from a time course FLIM experiment and performs the experiment-wide visualisation and quantification of changes in fluorescence lifetimes of each cell/object, compared to its reference measurement.

### Features of _**FLIMDAST**_:
 - It analyses FLIM data generated by the Time-Correlated Single Photon Counting (TCSPC)-based fluorescence lifetime measurements. 
 
 - As an input, it accepts 2D matrices of fluorescence lifetime and photon number values in pixel positions within an image. Typically, these are SPCImage export files in ASC format, or their ImageJ/FIJI derivatives saved in the text image format. 
 
 - _FLIMDAST_ visualises the intensity-dependent bias in fluorescence lifetime measurements characteristic for TCSPC by plotting fluorescence lifetimes in each pixel versus the number of detected photons in the same pixel. The intensity-dependend bias is apparent as a downwards slop of the fluorescence lifetime distribution along the photon number axis.
 
 - _FLIMDAST_ makes a visual and quantitative comparison of fluorescence lifetime distributions between two FLIM measurements. For each comparison, it needs a reference measurement of the same object/cell. 
 
 - The visual comparison of fluorescence lifetime distributions between FLIM measurement and its reference is achieved by overlaying the fluorescence lifetime versus photon number scatterplot for FLIM measurement over similarly presented reference data. In this representation, the down- or upward shift of the overlay distribution relative to the reference indicates fluorescence lifetime change that is independent of fluorescence intensity bias, while near-horisontal shift of the overlay within the plane of the reference distribution indicates change that is due to altered fluorescence intensity. 
 
 - The quantification of fluorescence intensity-independent change in the fluorescence lifetime of an object, relative to a reference measurement of the same object, is performed using the following algorithm: 
  - 1) each distribution is ordered and fitted with a local polynomial regression (loess, span = 0.1) that smoothens the distribution into a single line. In a discontinuous fit, the gaps are filled with average of the values at the gap bounadries;
  - 2) the overlapping range for the photon number spans between the lowest and the highest 99.5 percentile for each distribution is calculated and is set as the common intensity range for two distributions. It can be further manually narrowed by the user;
  - 3) the change in fluorescence lifetime is calculated as the difference in the sums of fluorescence lifetimes within the common intensity range between two fitted lines, divided by the common intensity range.

- Up to two additional regions selected within measured objects/cells can be visualised and quantified alongside the entire objects/cells. These selections are provided by the user as additional text image files generated in ImageJ/FIJI.

- Experiment layout is user designed and flexible, allowing for multiple experimental conditions/groups, multiple objects/cells per condition/group and multiple time points. The number of object per condition can vary between conditions, and the number of time points per object can vary between objects. 

- Visualisation and quantification parameters can be adjusted by the user.

- _FLIMDAST_ applies visualisation and quantification parameters set up by the user to generate the plots and the values of fluorescence lifetime change for the entire experiment.

- In addition to fluorescence life changes, _FLIMDAST_ calculates the average fluorescence lifetime and the average number of photon per pixel for each analysed dataset and its selected region.
 
## Requirements:
_FLIMDAST_ is developed for R version 3.3.3; other versions were not tested

It is recomended to run _FLIMDAST_ from RStudio. We use RStudio version 1.1.383; other versions were not tested

The _FLIMDAST_ requires the following R packages to be installed before running:
 shiny
 shinyFiles
 DT
 plyr
 dplyr
 ggplot2
 abind
 colorpicker
 shinydashboard
 shinyWidgets

Data files: 
FLIM measurements processed in SPCImage (Becker&Hickl) to quantify fluorescence lifetime in each pixel by fitting a single (preferred) or two- exponential decay model, exported as a pair of "...\_t1.asc" and "...\_photon.asc" files containing matrices of fluorescence lifetime and photon numbers in pixel positions, respectively. In case of two-exponential fitting, the mean fluorescence lifetime matrix needs to be generated from four export files, "...\_a1.asc","...\_t1.asc", "...\_a2.asc" and "...\_t2.asc" in ImageJ/FIJI, either manually or using the specifically designed tm_2cFLIM.ijm macro. 
Additional files with selected regions of interest derived in ImageJ/FIJI from the "...\_photon.asc" SPCImage export file. Each selected region should be reperesented by a separate file that is produced from the above "...\_photon.asc", by saving it as a text image file after selecting an area and setting all pixel values outside the selected area to zero.

## Installation:

## Usage:
