# FLIMDAST
_**FLIM DA**ta**S**et **T**ool_ to analyse fluorescence lifetime changes in a time course FLIM experiment

## Description:
*FLIMDAST* is a user interface app that assembles pre-processed fluorescence lifetime imaging (FLIM) data from a time course FLIM experiment and performs the experiment-wide visualisation and quantification of changes in fluorescence lifetimes of each cell/object, compared to its reference measurement.

### Features of _**FLIMDAST**_:
 - Analysis of FLIM data generated by the Time-Correlated Single Photon Counting (TCSPC)-based fluorescence lifetime measurements. 
 
 - Input data in a ASC or TXT format. For each measurement, at least two files are required, containing values of fluorescence lifetimes and photon numbers, respectively, in pixel positions of FLIM image. Typically, these are SPCImage export files in ASC format, or their ImageJ/FIJI derivatives saved in the text image format. 
 
 - Up to two additional regions within measured cells/objects. Each selected region should be provided as an additional text image file with photon numbers in pixel postions, generated in ImageJ/FIJI.
 
 - Visualisation of the intensity-dependent bias in fluorescence lifetime measurements characteristic for TCSPC, by plotting fluorescence lifetimes in each pixel versus the number of detected photons in the same pixel, with optional color-coding of selected regions. The intensity-dependend bias is apparent as a slop in the fluorescence lifetime distribution along the photon number axis.
 
 - Visual and quantitative comparison of fluorescence lifetime distributions between two FLIM measurements, one of which acts as a reference.  These should be repeated measurements of the same cell/object.
 
 - Visual comparison between two FLIM measurements by overlaying the scatterplots that plot fluorescence lifetime versus photon number for each measurement. In this representation, the down- or upward shift of the overlay relative to the reference indicates change in fluorescence lifetime that is independent of fluorescence intensity bias, while a near-horisontal shift of the overlay within the plane of the reference scatterolot indicates change that is due to altered fluorescence intensity. 
 
 - Quantification of fluorescence intensity-independent change in the fluorescence lifetime of an object, relative to a reference measurement of the same object, using the following algorithm: 
  > 1) each dataset is ordered by photon numbers and fitted with a local polynomial regression (loess, span = 0.1) that smoothens the distribution of fluorescence lifetime into a single line. It is furher converted to a sequence that has a single value of fluorescence lifetime for each sequential (integer) number of photons. For this, all fluorescence lifetime values that correspond to the same photon numbers are averaged to produce a single value, and the missing fluorescence lifetime values are filled by the average between fluorescence lifetime values from the next and the previous photon number that has such value; 
  > 2) the range of photon numbers between the lowest and the highest 99.5 percentile for each distribution is calculated, and their overlap is set as the common intensity range for two distributions. It can be further manually narrowed by the user;
  > 3) the change in fluorescence lifetime is calculated as the difference between the sums of all fluorescence lifetimes within the common intensity range for each fitted sequence, divided by the common intensity range.

- Flexible user-designed experiment layout, allowing for multiple experimental conditions/groups, multiple cells/objects per condition and multiple time points. 

- Adjustable visualisation and quantification parameters.

- A single step experiment-wide plotting and/or quantification of fluorescence lifetime changes in all measurements relative to their allocated references, with the user-desiged parameters.

- Quantification of mean values for the average fluorescence lifetimes and the average number of photon per pixel for each dataset in the experiment.
 
## Requirements:
_FLIMDAST_ is developed for R version 3.3.3; other versions were not tested

It is recomended to run _FLIMDAST_ from RStudio. We use RStudio version 1.1.383; other versions were not tested

The _FLIMDAST_ requires the following R packages to be installed before running:
 - shiny
 - shinyFiles
 - DT
 - plyr
 - dplyr
 - ggplot2
 - abind
 - colorpicker
 - shinydashboard
 - shinyWidgets

Data files for each measurement: 
 - A pair of SPCImage export files, containing matrices of fluorescence lifetime ("...\_t1.asc" file) and photon numbers ("...\_photon.asc" file) in pixel positions, respectively. These files are exported from SPCImage (Becker&Hickl) after fluorescence lifetime in each pixel of FLIM measurement has been quantified by fitting a single- (preferred) or a two- exponential decay model. In case of two-exponential fitting, the fluorescence lifetime input file containing mean fluorescence lifetime matrix needs to be generated from four SPCImage export files, "...\_a1.asc","...\_t1.asc", "...\_a2.asc" and "...\_t2.asc" in ImageJ/FIJI, either manually or using the specifically designed tm_2cFLIM.ijm macro (https://github.com/DinaDikovskaya/FLIMacro). 
 - Additional files with selected regions of interest.  Each selected region is provided as a separate file produced in ImageJ/FIJI from the photon number "...\_photon.asc" file, by saving it as a text image file after selecting an area of interest and setting all pixel values outside the selected area to zero.

## Installation:
Download the content of this repository, by clicking "Clone or download" and choosing "Download Zip".
Unzip downloaded folder, find the FLIMDAST folder inside it.
Place the FLIMDAST folder into a working directory on your computer. 
Open RStudio. Install required R packages that has not been installed previously. For this, in a Console of RStudio, type:

<p>install.packages(“shiny”)<br>
install.packages(“shinyFiles”)<br>
install.packages(“DT”)<br>
install.packages(“plyr”)<br>
install.packages(“dplyr”)<br>
install.packages(“shinyWidgets”)<br>
install.packages(“shinydashboard”)<br>
install.packages(“colorpicker”)<br>
install.packages(“abind”)<br>
install.packages(“ggplot2”)

## Running:
#### Method 1.
Make sure that RStudio's working directory contains downloaded FLIMDAST folder. To check, in a Console of RStudio, type:

list.files(path = getwd())

If the FLIMDAST folder is not listed, set up the correct working directory: under Session menu (top ribbon in RStudio), select "Set Working Directory", select "Choose Directory", navigate to the directory that contains FLIMDAST folder (but not to the FLIMDAST folder itself!) and click "Open". 

In a Console of RStudio, type: 

<p>library("shiny")<br>
runApp("FLIMDAST") 

#### Method 2.
Load app.R script from FLIMDAST folder in RStudio: under File (top ribbon in RStudio), select "Open", navigate to the FLIMDAST folder, and select app.R file inside it. The script will be loaded into a Source pane of RStudio. At the top of the script, click "Run App".

With both methods, the FLIMDAST will start in a local host window.  If desired, open FLIMDAST in a default web browser: click "Open in Browser" at the top of the window. Both options are very similar, apart from handling file downloads. 

Internet connection is not required for running downloaded FLIMDAST.  

To stop, close the local host window, or press the red "stop" button at the top of Console pane in RStudio


